/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var L=Object.defineProperty;var U=Object.getOwnPropertyDescriptor;var G=Object.getOwnPropertyNames;var _=Object.prototype.hasOwnProperty;var z=(x,b)=>{for(var t in b)L(x,t,{get:b[t],enumerable:!0})},Y=(x,b,t,e)=>{if(b&&typeof b=="object"||typeof b=="function")for(let s of G(b))!_.call(x,s)&&s!==t&&L(x,s,{get:()=>b[s],enumerable:!(e=U(b,s))||e.enumerable});return x};var J=x=>Y(L({},"__esModule",{value:!0}),x);var Z={};z(Z,{default:()=>N});module.exports=J(Z);var a=require("obsidian"),X={shuffleCards:!1,shuffleAnswers:!0,autoAdvance:!1,autoAdvanceIncorrect:!1,autoAdvanceDelay:1e3,defaultModalCardType:"multiple-choice",keyPreviousCard:"ArrowLeft",keyNextCard:"ArrowRight",keyResetSession:"r",enableKeyboardNav:!0},N=class extends a.Plugin{async onload(){await this.loadSettings(),this.addRibbonIcon("blocks","Create flashy cards",()=>{let t=this.app.workspace.getActiveViewOfType(a.MarkdownView);t?t.getMode()==="source"?new I(this.app,this.settings,e=>{e&&t.editor.replaceSelection(`
\`\`\`flashy
${e}
\`\`\`
`)}).open():new a.Notice("Please switch to editing view to create a flashcard."):new a.Notice("Please open a note to create a flashcard.")}),this.registerMarkdownCodeBlockProcessor("flashy",(t,e,s)=>{let i=this.settings,C,k,B,m,q=j(t);if(q.length===0){e.createEl("p",{text:"No valid flashy cards found. Check your syntax!",cls:"flashcard-error"});return}function M(r){let n=[...r];for(let o=n.length-1;o>0;o--){let l=Math.floor(Math.random()*(o+1));[n[o],n[l]]=[n[l],n[o]]}return n}function D(){let r=m?m[0]:void 0;if(k={correct:0,incorrect:0,answered:0},B=new Set,i.shuffleCards&&q.length>1)do m=M(q);while(r!==void 0&&m[0]===r);else m=[...q];C=0}let v=e.createDiv({cls:"flashcard-container"}),V=new a.MarkdownRenderChild(v);s.addChild(V);let R=r=>{if(!i.enableKeyboardNav)return;let n=e.win.document.activeElement,o=n&&n.tagName==="INPUT";if(!e.contains(n)&&!e.matches(":hover"))return;if(r.key===i.keyPreviousCard)r.preventDefault(),C>0&&E(C-1);else if(r.key===i.keyNextCard)r.preventDefault(),C<m.length-1&&E(C+1);else if(r.key.toLowerCase()===i.keyResetSession.toLowerCase()){if(o)return;r.preventDefault(),D(),E(0)}let l=parseInt(r.key);if(!isNaN(l)&&l>=1&&l<=9){if(o)return;r.preventDefault();let c=v.querySelectorAll(".flashcard-answer");c[l-1]&&!c[l-1].disabled&&c[l-1].click()}};V.registerDomEvent(e.win,"keydown",R);let P=r=>{if(B.has(C))return;B.add(C),r?k.correct++:k.incorrect++,k.answered++,(r&&i.autoAdvance||!r&&i.autoAdvanceIncorrect)&&C<m.length-1&&window.setTimeout(()=>{E(C+1)},i.autoAdvanceDelay),k.answered===m.length&&window.setTimeout(()=>$(),1e3)};function E(r){C=r,v.empty();let n=m[r];if(!n)return;n.customBackgroundColor?v.style.setProperty("--flashy-bg-override",n.customBackgroundColor):v.style.removeProperty("--flashy-bg-override"),n.customTextColor?v.style.setProperty("--flashy-text-override",n.customTextColor):v.style.removeProperty("--flashy-text-override"),H(v,n);let o=v.createDiv({cls:"flashcard-body"});switch(n.type){case"multiple-choice":O(o,n,P);break;case"fill-in-the-blank":K(o,n,P);break;case"qa":Q(o,n,P);break}W(v,r,m.length,E)}function $(){v.empty();let r=v.createDiv({cls:"flashcard-summary"});r.createEl("h3",{text:"Session complete!"});let n=m.length>0?k.correct/m.length*100:0;r.createEl("p",{text:`You answered ${k.correct} out of ${m.length} cards correctly on the first try.`}),r.createEl("p",{text:`Score: ${n.toFixed(0)}%`}),r.createEl("button",{text:"Review again",cls:"flashcard-reset"}).addEventListener("click",()=>{D(),E(0)})}function H(r,n){let o=r.createDiv({cls:"flashcard-header"}),l=o.createDiv(),c=n.question;n.type==="fill-in-the-blank"&&n.questionPartTwo&&(c+=" ___ "+n.questionPartTwo),l.createEl("p",{text:c,cls:"flashcard-question"});let d=o.createEl("button",{cls:"flashcard-reset flashy-icon-button"});(0,a.setIcon)(d,"refresh-cw"),d.ariaLabel="Reset session (R)",d.addEventListener("click",()=>{D(),E(0)})}function O(r,n,o){let l=r.createDiv({cls:"flashcard-buttons"}),c=n.answers,d=i.shuffleAnswers?M(c):c,h=c.filter(f=>f.isCorrect).length,g=0,u=!1,p=[],A=[];d.forEach(f=>{let w=l.createEl("button",{text:f.text,cls:"flashcard-answer"});p.push(w),f.isCorrect&&A.push(w),w.addEventListener("click",()=>{f.isCorrect?(w.classList.add("correct"),w.disabled=!0,g++,g===h&&(p.forEach(y=>{y.disabled||(y.disabled=!0)}),r.createEl("p",{text:"Correct!",cls:"flashcard-feedback correct"}),u||(o(!0),u=!0))):(w.classList.add("incorrect"),p.forEach(y=>y.disabled=!0),A.forEach(y=>y.classList.add("correct")),r.createEl("p",{text:"Incorrect",cls:"flashcard-feedback incorrect"}),u||(o(!1),u=!0))})})}function K(r,n,o){let l=r.createDiv({cls:"flashcard-fill-container"}),c=new a.TextComponent(l).setPlaceholder("Type your answer...").inputEl;c.classList.add("flashcard-fill-input");let d=l.createEl("button",{text:"Submit",cls:"flashcard-fill-submit"}),h=()=>{let u=c.value.trim().toLowerCase()===n.answer.toLowerCase();c.disabled=!0,d.disabled=!0,o(u);let p=u?"Correct!":"Incorrect",A=u?"correct":"incorrect";if(c.classList.add(A),r.createEl("p",{text:p,cls:`flashcard-feedback ${A}`}),!u){let f=r.createEl("p",{cls:"flashcard-correct-answer-reveal"});f.appendText("The correct answer was: "),f.createEl("span",{text:n.answer})}};d.addEventListener("click",h),c.addEventListener("keydown",g=>{g.key==="Enter"&&!g.isComposing&&(g.preventDefault(),h())})}function Q(r,n,o){let l=r.createDiv({cls:"qa-container"}),c=l.createDiv({cls:"qa-answer-container",text:n.answer});c.hide();let d=l.createDiv({cls:"qa-grading-buttons"});d.hide();let h=l.createEl("button",{text:"Show answer",cls:"mod-cta"}),g=d.createEl("button",{text:"I was right",cls:"qa-grading-button correct"}),u=d.createEl("button",{text:"I was wrong",cls:"qa-grading-button incorrect"}),p=A=>{o(A),g.disabled=!0,u.disabled=!0};g.addEventListener("click",()=>p(!0)),u.addEventListener("click",()=>p(!1)),h.addEventListener("click",()=>{h.hide(),c.show(),d.show()})}function W(r,n,o,l){let c=r.createDiv({cls:"flashcard-controls"}),d=c.createEl("button",{cls:"flashcard-nav flashy-icon-button"});(0,a.setIcon)(d,"arrow-left"),d.ariaLabel="Previous card (left arrow)",d.disabled=n===0,d.addEventListener("click",()=>l(n-1));let h=c.createDiv({cls:"flashcard-middle-controls"});o>1&&h.createEl("span",{text:`${n+1} / ${o}`,cls:"flashcard-progress"});let g=c.createEl("button",{cls:"flashcard-nav flashy-icon-button"});(0,a.setIcon)(g,"arrow-right"),g.ariaLabel="Next card (right arrow)",g.disabled=n>=o-1,g.addEventListener("click",()=>l(n+1))}function j(r){let n=r.trim(),o={},l=n.match(/^\[\[(.*?)]]\n?/);return l&&(l[1].trim().split(/\s+/).forEach(g=>{let[u,p]=g.split("=");u==="bg"&&p&&(o.bg=p),u==="color"&&p&&(o.color=p)}),n=n.substring(l[0].length)),n.split(/\n---\n/).map(d=>{var A;let h=d.trim().split(`
`).filter(f=>f.trim().length>0);if(h.length===0)return null;let g={};if(h[0].startsWith("[")&&h[0].endsWith("]")){let f=(A=h.shift())==null?void 0:A.slice(1,-1);f&&f.trim().split(/\s+/).forEach(y=>{let[T,S]=y.split("=");T==="bg"&&S&&(g.bg=S),T==="color"&&S&&(g.color=S)})}if(h.length===0)return null;let u=null,p=h.findIndex(f=>f.trim().startsWith("==="));if(p>-1){let f=h.slice(0,p).join(`
`).trim(),w=h[p].trim().substring(3).trim();f&&w&&(u={type:"qa",question:f,answer:w})}else{let f=h[0],w=f.match(/(.*){{(.*)}}(.*)/);if(w&&w[2]){let[,y,T,S]=w;u={type:"fill-in-the-blank",question:y.trim(),questionPartTwo:S.trim()||void 0,answer:T.trim()}}else if(h.length>1){let y=h.slice(1).map(T=>({text:T.trim().startsWith("=")?T.trim().substring(1).trim():T.trim(),isCorrect:T.trim().startsWith("=")}));y.some(T=>T.isCorrect)&&(u={type:"multiple-choice",question:f.trim(),answers:y})}}return u?(u.customBackgroundColor=g.bg||o.bg,u.customTextColor=g.color||o.color,u):null}).filter(d=>d!==null)}D(),E(0)}),this.addSettingTab(new F(this.app,this))}onunload(){}async loadSettings(){this.settings=Object.assign({},X,await this.loadData())}async saveSettings(){await this.saveData(this.settings)}},I=class extends a.Modal{constructor(t,e,s){super(t);this.cards=[];this.editingIndex=0;this.settings=e,this.onSubmit=s,this.cards.push(this.getEmptyCardData())}getEmptyCardData(){return{cardType:this.settings.defaultModalCardType,question:"",correctAnswers:"",incorrectAnswers:"",fitbText:"",qaAnswer:"",bgColor:"",textColor:""}}renderContent(){let{contentEl:t}=this;t.empty(),t.createEl("h2",{text:`Editing flashcard ${this.editingIndex+1} of ${this.cards.length}`}),this.renderCardForm(t.createDiv()),new a.Setting(t).addButton(e=>e.setButtonText("Previous card").setDisabled(this.editingIndex===0).onClick(()=>{this.editingIndex>0&&(this.editingIndex--,this.renderContent())})).addButton(e=>e.setButtonText(this.editingIndex===this.cards.length-1?"Add new card":"Next card").onClick(()=>{this.editingIndex++,this.editingIndex===this.cards.length&&this.cards.push(this.getEmptyCardData()),this.renderContent()})),new a.Setting(t).addButton(e=>e.setButtonText("Finish & insert deck").setCta().onClick(()=>{let s=this.buildDeckString();s&&this.onSubmit(s),this.close()}))}renderCardForm(t){let e=this.cards[this.editingIndex];new a.Setting(t).setName("Card type").addDropdown(s=>s.addOption("multiple-choice","Multiple choice").addOption("fill-in-the-blank","Fill-in-the-blank").addOption("qa","Question/answer").setValue(e.cardType).onChange(i=>{e.cardType=i,this.renderContent()})),e.cardType==="multiple-choice"?(new a.Setting(t).setName("Question").addText(s=>s.setPlaceholder("e.g., Which layer is the network layer?").setValue(e.question).onChange(i=>e.question=i)),new a.Setting(t).setName("Correct answer(s)").setDesc("One answer per line.").addTextArea(s=>{s.setPlaceholder("e.g., Layer 3").setValue(e.correctAnswers).onChange(i=>e.correctAnswers=i),s.inputEl.rows=4}),new a.Setting(t).setName("Incorrect answer(s)").setDesc("One answer per line.").addTextArea(s=>{s.setPlaceholder(`e.g., Layer 2
Layer 7`).setValue(e.incorrectAnswers).onChange(i=>e.incorrectAnswers=i),s.inputEl.rows=4})):e.cardType==="fill-in-the-blank"?new a.Setting(t).setName("Full text").setDesc("Wrap the answer in {{double curly braces}}.").addTextArea(s=>{s.setPlaceholder("e.g., The OSI model has {{seven}} layers.").setValue(e.fitbText).onChange(i=>e.fitbText=i),s.inputEl.rows=4}):(new a.Setting(t).setName("Question").addTextArea(s=>{s.setPlaceholder("e.g., What does the 'A' in CIA Triad stand for?").setValue(e.question).onChange(i=>e.question=i),s.inputEl.rows=4}),new a.Setting(t).setName("Answer").addTextArea(s=>{s.setPlaceholder("e.g., Availability").setValue(e.qaAnswer).onChange(i=>e.qaAnswer=i),s.inputEl.rows=4})),new a.Setting(t).setName("Custom background color").setDesc("(optional)").addText(s=>s.setValue(e.bgColor).onChange(i=>e.bgColor=i)),new a.Setting(t).setName("Custom text color").setDesc("(optional)").addText(s=>s.setValue(e.textColor).onChange(i=>e.textColor=i))}buildDeckString(){return this.cards.filter(t=>t.question&&t.question.trim()!==""||t.fitbText&&t.fitbText.trim()!=="").map(t=>{let e="",s=[];switch(t.bgColor&&s.push(`bg=${t.bgColor}`),t.textColor&&s.push(`color=${t.textColor}`),s.length>0&&(e+=`[${s.join(" ")}]
`),t.cardType){case"multiple-choice":{e+=`${t.question}
`;let i=t.correctAnswers.trim().split(`
`).map(k=>`=${k.trim()}`),C=t.incorrectAnswers.trim().split(`
`).map(k=>k.trim());e+=[...i,...C].filter(Boolean).join(`
`);break}case"fill-in-the-blank":e+=t.fitbText;break;case"qa":e+=`${t.question}
===${t.qaAnswer}`;break}return e}).join(`
---
`)}onOpen(){this.renderContent()}onClose(){this.contentEl.empty()}},F=class extends a.PluginSettingTab{constructor(t,e){super(t,e);this.plugin=e}display(){let{containerEl:t}=this;t.empty(),new a.Setting(t).setName("Behavior").setHeading(),new a.Setting(t).setName("Shuffle card order").setDesc("Randomize the order of cards within a block each session.").addToggle(e=>e.setValue(this.plugin.settings.shuffleCards).onChange(async s=>{this.plugin.settings.shuffleCards=s,await this.plugin.saveSettings(),this.app.workspace.updateOptions()})),new a.Setting(t).setName("Shuffle answer choices").setDesc("Randomize the order of answers for multiple-choice cards.").addToggle(e=>e.setValue(this.plugin.settings.shuffleAnswers).onChange(async s=>{this.plugin.settings.shuffleAnswers=s,await this.plugin.saveSettings(),this.app.workspace.updateOptions()})),new a.Setting(t).setName("Auto-advance on correct").setDesc("Automatically move to the next card after a correct answer.").addToggle(e=>e.setValue(this.plugin.settings.autoAdvance).onChange(async s=>{this.plugin.settings.autoAdvance=s,await this.plugin.saveSettings()})),new a.Setting(t).setName("Auto-advance on incorrect").setDesc("Automatically move to the next card after an incorrect answer.").addToggle(e=>e.setValue(this.plugin.settings.autoAdvanceIncorrect).onChange(async s=>{this.plugin.settings.autoAdvanceIncorrect=s,await this.plugin.saveSettings()})),new a.Setting(t).setName("Auto-advance delay (ms)").setDesc("The delay in milliseconds before advancing to the next card.").addText(e=>e.setValue(String(this.plugin.settings.autoAdvanceDelay)).onChange(async s=>{let i=parseInt(s);isNaN(i)||(this.plugin.settings.autoAdvanceDelay=i,await this.plugin.saveSettings())})),new a.Setting(t).setName("Card creation").setHeading(),new a.Setting(t).setName("Default card type in modal").setDesc("Choose the default card type when opening the card creation modal.").addDropdown(e=>e.addOption("multiple-choice","Multiple choice").addOption("fill-in-the-blank","Fill-in-the-blank").addOption("qa","Question/answer").setValue(this.plugin.settings.defaultModalCardType).onChange(async s=>{this.plugin.settings.defaultModalCardType=s,await this.plugin.saveSettings()})),new a.Setting(t).setName("Keyboard shortcuts").setHeading(),new a.Setting(t).setName("Enable keyboard navigation").setDesc("Allow using keys (like arrows, R, 1-9) to navigate and interact with flashcards while focused.").addToggle(e=>e.setValue(this.plugin.settings.enableKeyboardNav).onChange(async s=>{this.plugin.settings.enableKeyboardNav=s,await this.plugin.saveSettings(),this.display()})),this.plugin.settings.enableKeyboardNav&&(new a.Setting(t).setName("Previous card key").setDesc('Key to navigate to the previous card. Use values like "ArrowLeft", "a", "PageUp", etc.').addText(e=>e.setPlaceholder("ArrowLeft").setValue(this.plugin.settings.keyPreviousCard).onChange(async s=>{this.plugin.settings.keyPreviousCard=s.trim(),await this.plugin.saveSettings()})),new a.Setting(t).setName("Next card key").setDesc('Key to navigate to the next card. Use values like "ArrowRight", "d", "PageDown", etc.').addText(e=>e.setPlaceholder("ArrowRight").setValue(this.plugin.settings.keyNextCard).onChange(async s=>{this.plugin.settings.keyNextCard=s.trim(),await this.plugin.saveSettings()})),new a.Setting(t).setName("Reset session key").setDesc('Key to reset the current session. Use values like "r", "R", "F5" etc.').addText(e=>e.setPlaceholder("r").setValue(this.plugin.settings.keyResetSession).onChange(async s=>{this.plugin.settings.keyResetSession=s.trim(),await this.plugin.saveSettings()}))),new a.Setting(t).setName("Support").setHeading(),new a.Setting(t).setName("Sponsor development").setDesc("If you find Flashy useful, please consider supporting its development. It makes a huge difference!").addButton(e=>e.setButtonText("Buy me a coffee").setTooltip("https://buymeacoffee.com/masonguinn").onClick(()=>{window.open("https://buymeacoffee.com/masonguinn")})).controlEl.createEl("iframe",{attr:{src:"https://github.com/sponsors/MasonGuinn/button",title:"Sponsor MasonGuinn",height:"32",width:"114"},cls:"flashy-sponsor-iframe"})}};
