An enterprise today must consider multiple layers of defense when considering access to its servers. Some of those layers come in the form of firewalls. A firewall is used to monitor and control network traffic and can be used to block new network connections based on the origin and target of the request. Many firewalls are also stateful, so they can remember established connections and allow traffic to continue for connections that have already been created. There are two commonly used kinds of firewalls: network and host. Network firewalls are devices that are connected to multiple networks and control the flow of traffic between those networks. A common use case for a network firewall is a device that connects a private, protected network to a public network. The rules for a network firewall typically block incoming connections from the public network to the private network, except for the services that the private network is intended to provide. The rules allowing new connections from the private network to the public network are typically more lenient, even going as far as allowing all new connections. Host firewalls regulate the network traffic into and out of a single system. Traffic into a system consists of network connections from remote computers to services running on the system. Traffic out of the system consists of connections from processes on the system to remote computers. As with network firewalls, the rules for incoming connections are typically more strict than those for outgoing connections. Best practice for firewall configuration is to implement a default deny policy that says that any traffic not explicitly permitted by a firewall rule is disallowed by default. System administrators can then set firewall policies by creating rules that describe the types of traffic allowed to pass through the device. Modern versions of the Windows Server operating system come equipped with a built-in host firewall that can be configured by the system administrator. The rules can be configured manually on each machine. If the machine is part of a domain, they can also be configured using Group Policy Objects. In this lab, you will assume the role of a member of the team that implements the security policy for access to the machines on your network. You will configure the host firewall rules for a Windows server intended to act as a web server and verify that the machine conforms to the security policy.

Managing a host firewall does not only involve configuring firewall rules. As a member of a team, you need to have communication among the team members about the expectations for the security postures of the various components of the network. One way this is typically managed is by the creation of a security policy. Using a security policy has a few direct benefits: It provides a common document for use by all people involved in implementing the security controls. It can provide clarity about the goals of the security controls that are used. It can provide a set of requirements so that security controls can be tested.

Managing a host firewall does not only involve configuring firewall rules. As a member of a team, you need to have communication among the team members about the expectations for the security postures of the various components of the network. One way this is typically managed is by the creation of a security policy. Using a security policy has a few direct benefits: It provides a common document for use by all people involved in implementing the security controls. It can provide clarity about the goals of the security controls that are used. It can provide a set of requirements so that security controls can be tested.

Note: Profiles in Zenmap provide a way of creating preset scans. Zenmap uses the nmap tool in the background to perform each scan. The profile is used to specify the arguments used for the nmap command. Once you have chosen a profile, the command line that will be used will be shown in the command field of the toolbar. Another member of your team has already configured a profile that can be used to scan all the ports on a target machine for firewall testing

Note: The command field should now display the command nmap -sS -p 1-65535 -T4 -v -n -Pn --version-light 172.30.0.16. Later in this lab, you will learn what each of these arguments does. Once the scan starts, you will see output appear in the main panel. When the scan is complete, you should see a line at the bottom of the window stating that is has finished.

Note: Zenmap interprets the output from the nmap program and makes it available in other parts of the interface. The single host that was scanned now appears in the left panel. The Ports / Hosts tab gives a list of the ports that were found for the selected host. You should see multiple ports found in this list.

Note: You have identified several issues that need to be fixed. To match the firewall policy, there should be only one open port in this scan, port 80. Since multiple ports are listed, either the firewall is not active or the rules need to be adjusted. Several of the other open ports are used by windows services, but they should not be available to remote machines on untrusted networks. For a more complete analysis, your scan should also include UDP ports. Since a UDP scan can take a long time because of the differences in the protocol, for the sake of this lab, only a TCP scan is used.

Note: You should be prompted about saving the results. Zenmap allows you to save scan results. For now, you can skip saving the results. A real security policy might require you to provide documentation about the results of a port scan to confirm that a firewall is configured correctly. At this point, you are just doing checks to see what needs to be fixed.

The tests from a remote machine in the previous part have indicated that there are issues that need to be resolved in the firewall configuration on TargetWindows02. In a production environment, you might use remote access to the machine to manage the configuration. You might also use Group Policy objects if the machine was part of a domain. In this lab, you will use the lab access to the machine to manage the configuration. Windows classifies networks into three types: Domain networks, where the machine can authenticate to a domain controller Private networks, which are user assigned and should designate trusted networks Public networks, which are the default and should be used for untrusted networks Since a Windows machine can have multiple network interfaces, each network it is attached to is classified as one of these types. The firewall rules that apply to that interface depend on the profile it has been assigned. Each firewall rule also has many potential conditions for when it should be applied, in addition to the profile. The kinds of conditions that can be used include the following: The source IP address and port The target IP address and port Remote and local users The remote machine identity Some of these conditions are specific to Windows firewalls, and others are common to many kinds of firewalls. The security policy specifies the rules based only on the source network and the ports. In this part of the lab, you will configure Windows Defender Firewall so that it conforms to the security policy.

Note: The window has the three sections common to many Windows management programs. On the left side, there is a navigation pane. On the right side, there is a list of actions that depend on the currently selected object. The center pane contains details for the current selection. The menu bar can also be used to perform actions on the current selection. By default, the top level of the tree in the navigation panel should be selected, and the center panel should show a summary of the firewall status.

Note: You should see that the firewall is initially off. That is a good reason why multiple ports were open. The firewall cannot block access when it is not activated. The connections you need to block are coming in from the LAN network, so you need to determine which profile should be modified.

Note: You should see that the Student interface is marked as a public network. Therefore, you need to make sure the rules that you create apply to public networks.

Note: The first step you need to accomplish is to turn on the firewall for public networks. This can be accomplished through the properties dialog. You should see a tab for each profile, along with a tab for IPSec settings.

Note: You can also specify the default policy for inbound and outbound rules. The default of block inbound connections and allow outbound connections matches the required policy. The Customize buttons for Settings opens a dialog in which you can modify the actions when connections are blocked and how local rules are merged with rules from Group Policy. The Customize button for Logging can be used to control what is logged. For this lab, you can leave those settings at their defaults.

Note: The list of rules should be a bit shorter now, but there seem to be a lot of rules allowing traffic. This could be a bit concerning. However, many of these rules apply to basic protocols for networking, like ICMP and IPv6. You should also see that some of the rules have “All” as the profile, so they apply to all profiles, not just the public profile. The rules in the Core Networking group can be left enabled. These do not correspond to any of the open ports that were discovered because they do not apply to packets using the TCP protocol.

In Section 1 of this lab, you activated and managed the rules of Windows firewall using the Windows Defender Firewall with Advanced Settings application. This is a convenient method for making changes when you have access to the server desktop. In some situations, it is simpler to gain access to a machine using PowerShell. It is also possible to manage the configuration of the Windows firewall using PowerShell commands. In the next steps, you will use PowerShell commands to query the state of the firewall and make changes to the configuration. Since the configuration was already updated in Section 1, you will first need to reset the machine to its initial state.

Note: You should see a table showing a list of the profiles and their status. At this point, the firewall should be disabled for all the profiles since the machine was just reset. The Get-NetFirewallProfile command actually returns quite a bit of information about the profiles. These results were then passed through the Format-Table command to show only the Name and Enabled fields as columns in a table.

Note: This is very similar to the command used by Zenmap (minus the argument --version-light). The arguments control the functioning of nmap as follows: -sS indicates that a stealth SYN scan should be used. -p 1-65535 gives the list of ports to be scanned. -T4 sets the timing to be used for the scan (higher numbers are more aggressive). -v makes the output more verbose. It is used here to show progress as the scan proceeds. -n prevents nmap from using DNS to resolve names, which can speed up the scan in some cases. -Pn prevents a ping scan from being used to check for hosts. 172.30.0.16 sets the target to be scanned. Since we are scanning a single known host, the ping scan can be skipped. Remember, this scans only the TCP ports listed. In a real production environment, you would also want to include a UDP scan. It is often helpful to use different commands for UDP and TCP scans because the UDP scan can be significantly slower.